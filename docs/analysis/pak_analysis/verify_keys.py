import struct

# Read raw PAK file and verify our derived keys work correctly
files = [
    {"filename": "2k_ChatUI.xml", "offset": 0x27D, "size": 4803,
     "key": [0xB6, 0x18, 0xC5, 0x65, 0xB0, 0xF3, 0x2F, 0x8F, 0x8A, 0xF0, 0x1B, 0xA4, 0xEB, 0x91, 0xC0, 0xFF,
             0x9F, 0x96, 0x90, 0x33, 0x19, 0xBF, 0xE2, 0x13, 0xB6, 0xFA, 0xC5, 0xE5, 0x69, 0x6F, 0x9C, 0x16,
             0xFE, 0x7B, 0x9F, 0x83, 0xCC, 0x5D]},
    {"filename": "2k_MainButtonUI.xml", "offset": 0x1540, "size": 4864,
     "key": [0x59, 0xCA, 0x5F, 0xE0, 0xFA, 0x15, 0x6A, 0x58, 0xF5, 0x52, 0xE6, 0x48, 0xF9, 0x16, 0x6A, 0x78,
             0xDE, 0x0D, 0xF0, 0x16, 0x24, 0x2E, 0xBF, 0xC1, 0x8B, 0xA1, 0x3A, 0xF5, 0x35, 0x2C, 0x73, 0xB1,
             0x4B, 0x8F, 0xFB, 0xF4, 0x4A, 0x40]},
    {"filename": "2k_MainCharInfoUI.xml", "offset": 0x2840, "size": 297,
     "key": [0xD9, 0x2A, 0xD2, 0xA7, 0xFC, 0xA7, 0x19, 0x54, 0xA6, 0xA0, 0xC3, 0x53, 0x15, 0x5C, 0x9F, 0x55,
             0xB9, 0x40, 0x15, 0xCB, 0x40, 0x23, 0x70, 0x9B, 0x70, 0x1B, 0x0C, 0x70, 0xD7, 0x32, 0xBD, 0x64,
             0xF6, 0x4B, 0x91, 0x90, 0x82, 0x5A]},
]

pak_file = r"D:\L1R Project\LineageWarriorClient\ui.pak"

# Known plaintext
plaintext = b'<?xml version="1.0" encoding="UTF-8"?>'

print("Verifying encryption keys by decrypting raw PAK data...\n")

with open(pak_file, 'rb') as f:
    for file_info in files:
        print(f"File: {file_info['filename']}")
        print(f"  Offset: 0x{file_info['offset']:X}")

        # Read encrypted data from PAK
        f.seek(file_info['offset'])
        encrypted = f.read(min(200, file_info['size']))

        # Decrypt using derived key
        key = bytes(file_info['key'])
        decrypted = bytes([encrypted[i] ^ key[i % len(key)] for i in range(len(encrypted))])

        print(f"  Encrypted (hex): {encrypted[:38].hex(' ').upper()}")
        print(f"  Key (hex):       {key.hex(' ').upper()}")
        print(f"  Decrypted:       {decrypted[:60]}")
        print(f"  Expected:        {plaintext}")
        print(f"  Match: {decrypted[:len(plaintext)] == plaintext}")
        print()
