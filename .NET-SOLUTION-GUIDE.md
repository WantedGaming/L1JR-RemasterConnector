# .NET Solution Structure Guide

## Overview

This document describes the .NET 8.0 solution structure for the L1R Custom Launcher, following Clean Architecture principles with MVVM pattern for the WPF application.

## Solution Structure

```
LineageLauncher.sln
├── src/
│   ├── LineageLauncher.Core/              # Domain Layer (no dependencies)
│   ├── LineageLauncher.Crypto/            # Cryptography implementation
│   ├── LineageLauncher.Network/           # HTTP API client
│   ├── LineageLauncher.Patcher/           # File patching engine
│   ├── LineageLauncher.Launcher/          # Process management
│   ├── LineageLauncher.Infrastructure/    # DI and configuration
│   └── LineageLauncher.App/               # WPF Application (EXE)
├── tests/
│   ├── LineageLauncher.UnitTests/
│   └── LineageLauncher.IntegrationTests/
├── Directory.Build.props                   # Common project properties
└── LineageLauncher.sln                    # Solution file
```

## Clean Architecture Dependency Flow

```
Core (Domain Layer - No Dependencies)
  ↑
Crypto, Network, Patcher, Launcher (Application Layer - Depend only on Core)
  ↑
Infrastructure (Infrastructure Layer - Depends on Core + Implementations)
  ↑
App (Presentation Layer - Depends on Infrastructure)
```

## Project Details

### 1. LineageLauncher.Core
**Type:** .NET 8.0 Class Library
**Purpose:** Domain models, entities, and interfaces
**Dependencies:** None (Clean Architecture rule)

**Key Components:**
- `Entities/`: Domain entities (User, ServerInfo, PatchManifest, LauncherConfig)
- `Interfaces/`: Service contracts (IAuthenticationService, IPatchService, ILauncherService, IPasswordHasher)

### 2. LineageLauncher.Crypto
**Type:** .NET 8.0 Class Library
**Purpose:** Cryptography and security
**Dependencies:** Core only

**Key Components:**
- `Argon2PasswordHasher`: Implements IPasswordHasher using Argon2id
- `XorEncryption`: XOR encryption for Lin.bin parameters

**NuGet Packages:**
- Konscious.Security.Cryptography.Argon2 (1.3.1)

### 3. LineageLauncher.Network
**Type:** .NET 8.0 Class Library
**Purpose:** HTTP API client for L1JR-Server communication
**Dependencies:** Core only

**Key Components:**
- `L1JRApiClient`: HTTP client with Polly retry policies

**NuGet Packages:**
- Polly (8.4.2) - Resilience and transient-fault-handling
- System.Net.Http.Json (8.0.1)

### 4. LineageLauncher.Patcher
**Type:** .NET 8.0 Class Library
**Purpose:** File patching engine with parallel downloads
**Dependencies:** Core, Network

**Key Components:**
- `PatchEngine`: Implements IPatchService with Zstandard compression

**NuGet Packages:**
- ZstdSharp.Port (0.8.2) - Zstandard compression

### 5. LineageLauncher.Launcher
**Type:** .NET 8.0 Class Library
**Purpose:** Game process management
**Dependencies:** Core only

**Key Components:**
- `GameLauncher`: Implements ILauncherService for Lin.bin launching

### 6. LineageLauncher.Infrastructure
**Type:** .NET 8.0 Class Library
**Purpose:** Dependency injection and configuration
**Dependencies:** Core, Crypto, Network, Patcher, Launcher

**Key Components:**
- `ServiceCollectionExtensions`: DI container setup

**NuGet Packages:**
- Microsoft.Extensions.Configuration (8.0.0)
- Microsoft.Extensions.Configuration.Json (8.0.1)
- Microsoft.Extensions.DependencyInjection (8.0.1)
- Microsoft.Extensions.Http (8.0.1)
- Microsoft.Extensions.Logging (8.0.1)
- Microsoft.Extensions.Logging.Console (8.0.1)
- Microsoft.Extensions.Logging.Debug (8.0.1)
- Microsoft.Extensions.Options.ConfigurationExtensions (8.0.0)

### 7. LineageLauncher.App
**Type:** .NET 8.0 Windows WPF Application (EXE)
**Purpose:** User interface and application entry point
**Dependencies:** Infrastructure (which brings all other projects)

**Key Components:**
- `App.xaml/.cs`: Application entry point with DI container
- `MainWindow.xaml/.cs`: Main window (MVVM)
- `appsettings.json`: Configuration file

**NuGet Packages:**
- ModernWpfUI (0.9.6) - Modern Windows 11 styling
- Microsoft.Web.WebView2 (1.0.2792.45) - Embedded browser
- Microsoft.Extensions.DependencyInjection (8.0.1)
- Microsoft.Extensions.Hosting (8.0.1)
- CommunityToolkit.Mvvm (8.3.2) - MVVM helpers

### 8. LineageLauncher.UnitTests
**Type:** xUnit Test Project
**Purpose:** Unit testing for all projects
**Dependencies:** All src projects except App

**NuGet Packages:**
- xUnit (2.9.2)
- xunit.runner.visualstudio (2.8.2)
- Moq (4.20.72)
- FluentAssertions (6.12.2)
- Microsoft.NET.Test.Sdk (17.11.1)

### 9. LineageLauncher.IntegrationTests
**Type:** xUnit Test Project
**Purpose:** Integration testing
**Dependencies:** Infrastructure

**NuGet Packages:**
- xUnit (2.9.2)
- xunit.runner.visualstudio (2.8.2)
- Moq (4.20.72)
- FluentAssertions (6.12.2)
- Microsoft.NET.Test.Sdk (17.11.1)
- Testcontainers (3.10.0)

## Common Build Properties

The `Directory.Build.props` file at the solution root defines common properties for all projects:

```xml
- LangVersion: 12 (C# 12)
- Nullable: enable (Nullable reference types)
- ImplicitUsings: enable (Global usings)
- TreatWarningsAsErrors: true (Strict compilation)
- TargetFramework: net8.0
```

## Building the Solution

```bash
# Restore NuGet packages
dotnet restore

# Build all projects
dotnet build

# Run tests
dotnet test

# Build specific project
dotnet build src/LineageLauncher.Core

# Run the application
dotnet run --project src/LineageLauncher.App
```

## Adding New Projects

When adding new projects to the solution, follow these guidelines:

1. **Follow Clean Architecture rules:**
   - Core should have NO dependencies
   - Implementation projects (Crypto, Network, etc.) should depend ONLY on Core
   - Infrastructure depends on Core + implementations
   - App depends on Infrastructure

2. **Add project to solution:**
   ```bash
   dotnet sln add path/to/NewProject.csproj
   ```

3. **Ensure proper project references:**
   ```bash
   dotnet add src/NewProject reference src/LineageLauncher.Core
   ```

## Development Workflow

1. **Domain-First Development:**
   - Start by defining entities and interfaces in Core
   - Implement interfaces in respective projects (Crypto, Network, etc.)
   - Register implementations in Infrastructure
   - Consume services in App

2. **Testing:**
   - Write unit tests in LineageLauncher.UnitTests
   - Write integration tests in LineageLauncher.IntegrationTests
   - Run tests before committing: `dotnet test`

3. **Configuration:**
   - Edit `appsettings.json` for application settings
   - Use `IConfiguration` to access settings
   - Bind settings to strongly-typed classes

## Key Design Decisions

### Why Clean Architecture?
- **Separation of Concerns:** Each layer has a clear responsibility
- **Testability:** Core domain logic is isolated and easy to test
- **Maintainability:** Changes in infrastructure don't affect domain logic
- **Flexibility:** Easy to swap implementations (e.g., different HTTP client)

### Why .NET 8.0?
- Long-term support (LTS) release
- Best performance and latest C# 12 features
- Excellent WPF support for Windows applications

### Why These Libraries?
- **ModernWpfUI:** Modern Windows 11 look and feel
- **Polly:** Robust retry policies and resilience
- **Argon2id:** Industry-standard password hashing
- **Zstandard:** Fast compression for patch files
- **WebView2:** Modern web content rendering

## Next Steps

1. **Implement remaining services:**
   - AuthenticationService implementation
   - Complete PatchEngine implementation
   - Complete GameLauncher implementation

2. **Build ViewModels:**
   - LoginViewModel
   - PatchViewModel
   - MainViewModel

3. **Create Views:**
   - LoginView
   - PatchProgressView
   - ServerStatusView

4. **Add Assets:**
   - Icons and images
   - Application manifest

5. **Implement Configuration:**
   - Server configuration
   - Game path configuration
   - User preferences

## References

- [Clean Architecture by Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [.NET 8.0 Documentation](https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-8)
- [WPF Documentation](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/)
- [MVVM Pattern](https://docs.microsoft.com/en-us/dotnet/architecture/modernize-desktop/mvvm-pattern)
